#!/usr/bin/env bash

DIR=$( cd "$(dirname "${BASH_SOURCE[0]}")" || exit ; pwd -P )
LOG_FILE="${DIR}/build.log"
POOL="${HOME}/.local/share/runc/pool"

# Check if container exists
CONTAINER=$1
VALID=1
for i in $(cd ${POOL} && ls -d */ | cut -f1 -d'/'); do
	if [ "${CONTAINER}" == "${i}" ]; then
		VALID=0
	fi
done

if [ ${VALID} -eq 1 ]; then
	>&2 echo "ERROR: ${CONTAINER}: This container doesn't exist"
	exit 1
fi

# Unmount the read-only part of the image
fusermount -u ${POOL}/${CONTAINER}/rootfs/mnt

# Delete all the container files
rm -rf ${POOL}/${CONTAINER}
