#!/usr/bin/env bash

DIR=$( cd "$(dirname "${BASH_SOURCE[0]}")" || exit ; pwd -P )
LOG_FILE="${DIR}/build.log"

cd $DIR || exit
source runc.config

CONTAINER=$1

# Check if the container exists
VALID=1
for i in $(cd ${POOL} && ls -d */ | cut -f1 -d'/'); do
	if [ "${CONTAINER}" == "${i}" ]; then
		VALID=0
	fi
done

if [ ${VALID} -eq 1 ]; then
	>&2 echo "ERROR: ${CONTAINER}: The container doesn't exist"
	exit 1
fi

runc list | grep ${CONTAINER} &> /dev/null
if [ $(echo $?) -ne 0 ]; then
    >&2 echo "ERROR: ${CONTAINER}: The container was already stopped"
    exit 1
fi

runc kill ${CONTAINER} &> /dev/null
runc list | grep ${CONTAINER} | grep "running" &> /dev/null
while [ $(echo $?) -eq 0 ]; do
    sleep 1
    runc list | grep ${CONTAINER} | grep "running" &> /dev/null
done
runc delete ${CONTAINER} &> /dev/null

echo "Done"
